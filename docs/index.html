<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>HUB Dual — PWA</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1e2235" />
    <style>
      :root{
        --grad-a:#ff52e5; --grad-b:#00c5e5;
        --text:#f5f7ff; --muted:rgba(245,247,255,.65);
        --surface:rgba(15,17,32,.45); --surface-strong:rgba(15,17,32,.85);
        --border:rgba(255,255,255,.12);
        --radius:24px; --radius-lg:28px; --shadow:0 10px 30px rgba(0,0,0,.35);
        --header-h:78px; --tabbar-pad:10px;
      }
      @supports not (padding: env(safe-area-inset-bottom)) { :root{ --safe:0px; } }
      @supports (padding: env(safe-area-inset-bottom)) { :root{ --safe: env(safe-area-inset-bottom); } }

      *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
      html,body{ height:100%; margin:0; }
      body{
        font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        background:linear-gradient(42deg,var(--grad-a),var(--grad-b)) fixed;
        color:var(--text); overflow-x:hidden; overscroll-behavior-y:contain;
        min-height:100dvh; display:flex; flex-direction:column;
      }

      /* HEADER */
      header{
        position:fixed; inset:0 0 auto 0; height:var(--header-h);
        display:flex; align-items:center; justify-content:space-between;
        padding:0 16px; backdrop-filter:blur(16px) saturate(120%); z-index:100;
      }
      .icon-btn{ width:42px; height:42px; border-radius:50%; display:grid; place-items:center;
        background:var(--surface); border:1px solid var(--border); box-shadow:var(--shadow); color:var(--text); }
      .icon-btn:active{ transform:scale(.96); }
      .title{ flex:1; text-align:center; line-height:1.1; }
      .title h1{ margin:0; font-size:22px; font-weight:900; letter-spacing:.05em; }
      .title small{ display:block; font-size:12px; letter-spacing:.08em; color:var(--muted); }

      /* MAIN */
      main{
        padding-top: calc(var(--header-h) + 12px);
        padding-bottom: calc(86px + var(--safe)); /* espaço reservado para a tabbar + input dock */
        width:100%; max-width:480px; margin:0 auto; position:relative;
      }
      section{ display:none; }
      section.active{ display:block; }

      /* APPS GRID */
      .apps-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
        gap:14px; padding:0 16px; }
      .app-icon{ display:flex; flex-direction:column; align-items:center; justify-content:center;
        background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
        box-shadow:var(--shadow); height:84px; cursor:pointer; }
      .app-icon span{ margin-top:6px; font-size:12px; font-weight:600; color:var(--muted); }
      .app-icon svg{ width:28px; height:28px; }

      /* TABBAR + INPUT DOCK */
      footer.tabbar{
        position:fixed; left:0; right:0; bottom:0; z-index:120;
        padding:6px 14px calc(6px + var(--safe));
      }
      .tabbar .container{
        width:100%; max-width:480px; margin:0 auto;
        background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-lg);
        box-shadow:var(--shadow); padding: var(--tabbar-pad);
        display:grid; grid-template-columns:1fr; gap:10px;
      }

      /* linha de tabs */
      .tabs{
        display:flex; align-items:center; justify-content:space-around; gap:6px;
      }
      .tab{
        flex:1; display:flex; flex-direction:column; align-items:center; gap:4px;
        padding:8px 0; border-radius:16px; color:var(--muted); font-size:11px; font-weight:700;
      }
      .tab.active{ color:var(--text); background:rgba(255,255,255,.10); box-shadow:inset 0 0 0 1px rgba(255,255,255,.12); }
      .tab svg{ width:22px; height:22px; }

      /* Input Dock */
      .dock{
        display:grid; grid-template-columns: 1fr auto auto auto auto; gap:8px; align-items:center;
        background: rgba(255,255,255,.06); border:1px solid var(--border); border-radius:16px; padding:8px;
      }
      .dock.hidden-icons .dock-btn{ display:none; }   /* esconde botões laterais quando “ocultar” */
      .dock.hidden-icons .dock-input{ grid-column: 1 / -1; } /* input ocupa toda largura */

      .dock-input{
        display:flex; align-items:center; gap:8px; background: rgba(0,0,0,.22);
        border:1px solid rgba(255,255,255,.14); border-radius:12px; padding:6px 10px;
      }
      .dock-input input{
        appearance:none; border:0; outline:0; background:transparent; color:var(--text);
        width:100%; font-size:14px;
      }
      .dock-btn{
        width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
        background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14);
      }
      .dock-btn:active{ transform:scale(.96); }

      /* Botão-frase (toggle) */
      .mantra{
        display:flex; align-items:center; justify-content:center;
        border-radius:14px; padding:10px 12px;
        background: linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
        border:1px solid rgba(255,255,255,.14); font-weight:600;
        cursor:pointer; text-align:center;
      }
      .mantra strong{ font-weight:800; }

      /* Painel de ações (abre pela frase) */
      .actions{
        display:none; grid-template-columns: repeat(4, minmax(0,1fr)); gap:8px;
      }
      .actions.open{ display:grid; }
      .pill{
        display:flex; align-items:center; justify-content:center; gap:6px;
        padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.08);
        border:1px solid rgba(255,255,255,.14); font-size:13px; font-weight:700;
      }

      /* Chat cards toggle (use classe .chat-card no seu chat) */
      .hide-cards .chat-card{ display:none !important; }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header>
      <button class="icon-btn" id="backBtn" aria-label="Voltar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6" />
        </svg>
      </button>
      <div class="title">
        <h1>HUB DUAL</h1>
        <small>UNO Dual Trinity</small>
      </div>
      <button class="icon-btn" id="brainBtn" aria-haspopup="true" aria-expanded="false" aria-label="Dual Brain">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21a8 8 0 1 0-16 0" />
          <circle cx="12" cy="7" r="4" />
        </svg>
      </button>

      <!-- Brain menu -->
      <div class="brain-menu" id="brainMenu" style="display:none; position:absolute; top:calc(100% + 6px); right:16px; width:min(92vw,340px); padding:12px; background:var(--surface-strong); border:1px solid var(--border); border-radius:var(--radius-lg); box-shadow:var(--shadow); z-index:150;">
        <h3 style="margin:4px 0 10px; font-size:16px; font-weight:800; letter-spacing:.05em;">Brain</h3>
        <ul class="brain-list" style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;">
          <li class="brain-item" onclick="exportBackup()" style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:18px;background:rgba(255,255,255,.05);border:1px solid var(--border);cursor:pointer;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>
            <span style="flex:1;font-weight:600;font-size:14px;">Exportar</span>
          </li>
          <li class="brain-item" onclick="promptKey()" style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:18px;background:rgba(255,255,255,.05);border:1px solid var(--border);cursor:pointer;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M21 2l-2 2" /><path d="M7.5 13.5L2 19v3h3l5.5-5.5" /><circle cx="16" cy="8" r="5" /></svg>
            <span style="flex:1;font-weight:600;font-size:14px;">SK Key</span>
          </li>
          <li class="brain-item" onclick="toast('Testar TTS')" style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:18px;background:rgba(255,255,255,.05);border:1px solid var(--border);cursor:pointer;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z" /></svg>
            <span style="flex:1;font-weight:600;font-size:14px;">TTS</span>
          </li>
          <li class="brain-item" onclick="clearLogs()" style="display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:18px;background:rgba(255,255,255,.05);border:1px solid var(--border);cursor:pointer;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M3 3h18" /><path d="M3 8h18" /><path d="M3 13h18" /><path d="M3 18h18" /></svg>
            <span style="flex:1;font-weight:600;font-size:14px;">Logs</span>
          </li>
        </ul>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <section id="page-home" class="active">
        <div style="padding:20px; text-align:center;">
          <p>Bem-vindo ao Dual Hub! Toque em <strong>Apps</strong> para explorar.</p>
        </div>
      </section>

      <section id="page-apps"><div class="apps-grid" id="appsGrid"></div></section>

      <section id="page-stack">
        <div style="padding:20px; text-align:center;"><p>Sem apps abertos por enquanto.</p></div>
      </section>
    </main>

    <!-- TABBAR + INPUT DOCK -->
    <footer class="tabbar">
      <div class="container" id="tabbarContainer">
        <!-- 1) linha de tabs -->
        <div class="tabs">
          <div class="tab active" id="tab-home" onclick="navigate('home')">
            <svg><use href="#hub_home"></use></svg><span>Home</span>
          </div>
          <div class="tab" id="tab-apps" onclick="navigate('apps')">
            <svg><use href="#hub_apps"></use></svg><span>Apps</span>
          </div>
          <div class="tab" id="tab-stack" onclick="navigate('stack')">
            <svg><use href="#hub_stack"></use></svg><span>Stack</span>
          </div>
        </div>

        <!-- 2) Input Dock -->
        <div class="dock" id="dock">
          <div class="dock-input">
            <input id="promptInput" placeholder="Escreva sua intenção..." autocomplete="off" />
            <button class="dock-btn" title="GIF" onclick="onGif()"><span>🎞️</span></button>
          </div>
          <button class="dock-btn" title="Arteask" onclick="onArteask()">✨</button>
          <button class="dock-btn" title="Voz" onclick="onVoz()">🎙️</button>
          <button class="dock-btn" title="Enviar" onclick="onSend()">➤</button>
          <button class="dock-btn" title="Cards" onclick="toggleCards()">▤</button>
        </div>

        <!-- 3) Botão-frase -->
        <button class="mantra" id="mantraBtn" onclick="toggleActions()">
          do seu jeito. <strong>Sempre</strong> único, <strong>sempre</strong> seu.
        </button>

        <!-- 4) Painel de ações -->
        <div class="actions" id="actionsPanel">
          <button class="pill" onclick="copyPrompt()">⎘ Copiar</button>
          <button class="pill" onclick="pastePrompt()">📎 Colar</button>
          <button class="pill" onclick="toggleIcons()">🙈 Ocultar</button>
          <button class="pill" onclick="toggleActions()">✕ Fechar</button>
        </div>
      </div>
    </footer>

    <!-- SPRITE DEFAULT (fallback) -->
    <svg style="display:none" aria-hidden="true">
      <defs id="icon-defs">
        <symbol id="hub_home" viewBox="0 0 24 24"><path d="M3 12l9-9 9 9" stroke="currentColor" stroke-width="2" fill="none"/><path d="M9 21V9h6v12" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
        <symbol id="hub_apps" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><rect x="14" y="3" width="7" height="7" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><rect x="14" y="14" width="7" height="7" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><rect x="3" y="14" width="7" height="7" rx="2" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
        <symbol id="hub_stack" viewBox="0 0 24 24"><path d="M12 2l9 4.5-9 4.5L3 6.5 12 2z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M3 13l9 4.5 9-4.5" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
      </defs>
    </svg>

    <script>
      /* UTIL */
      const qs = sel => document.querySelector(sel);
      const ls = {
        get:k=>{ try{return JSON.parse(localStorage.getItem(k));}catch(e){return null;} },
        set:(k,v)=>{ try{localStorage.setItem(k,JSON.stringify(v));}catch(e){} }
      };
      const STATE_KEY = "dual.hub.ui";

      function toast(m){ console.log("[Dual]", m); }

      /* NAV */
      function navigate(target){
        ['home','apps','stack'].forEach(pg=>{
          const sec = qs('#page-'+pg); const tab = qs('#tab-'+pg);
          if(sec) sec.classList.toggle('active', pg===target);
          if(tab) tab.classList.toggle('active', pg===target);
        });
        if(target==='apps' && !navigate._appsLoaded){ loadApps(); navigate._appsLoaded = true; }
      }

      /* BRAIN MENU */
      const brainBtn = qs('#brainBtn');
      const brainMenu = qs('#brainMenu');
      brainBtn.addEventListener('click', (e)=>{ brainMenu.style.display = (brainMenu.style.display==='none'||!brainMenu.style.display)?'block':'none'; e.stopPropagation(); });
      document.addEventListener('click', (e)=>{ if(!brainMenu.contains(e.target) && e.target!==brainBtn){ brainMenu.style.display='none'; }});

      function exportBackup(){
        const data = { when: Date.now(), storage: localStorage };
        const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
        const url = URL.createObjectURL(blob); const a=document.createElement('a');
        a.href=url; a.download='dual.backup.json'; a.click(); URL.revokeObjectURL(url); toast('Backup exportado');
      }
      function promptKey(){
        const key = prompt('Cole sua SK (salva localmente)'); if(key){ localStorage.setItem('dual.keys.openrouter', key); toast('Chave armazenada'); }
      }
      function clearLogs(){ console.clear(); toast('Logs limpos'); }

      /* APPS from apps.json (root) com fallback para apps/apps.json */
      async function loadApps(){
        const grid = qs('#appsGrid'); grid.innerHTML='';
        async function getJSON(path){ try{ const r=await fetch(path); if(r.ok) return r.json(); }catch(e){} return null; }
        // tenta root apps.json (estrutura por grupos)
        let data = await getJSON('apps.json');
        if(!data){ data = await getJSON('apps/apps.json'); } // fallback antigo
        if(data && data.groups){
          // varre todos os grupos
          Object.values(data.groups).forEach(group=>{
            group.forEach(app=>{
              const div=document.createElement('div'); div.className='app-icon';
              div.onclick=()=>window.open(app.url,'_blank');
              const img=document.createElement('img'); img.src=app.icon || (data.defaultIcons?.base||'/icons/icon-192.png'); img.alt='';
              const span=document.createElement('span'); span.textContent=app.title;
              div.appendChild(img); div.appendChild(span); grid.appendChild(div);
            });
          });
        }else{
          // fallback ultra simples
          const apps=[{title:'Chat',icon:'/icons/icon-192-chats.png',url:'#'},{title:'Editor',icon:'/icons/icon-192-editors.png',url:'#'}];
          apps.forEach(app=>{
            const div=document.createElement('div'); div.className='app-icon';
            div.onclick=()=>toast('Abrindo '+app.title);
            div.innerHTML=`<img src="${app.icon}" alt=""><span>${app.title}</span>`; grid.appendChild(div);
          });
        }
      }

      /* INPUT DOCK — Handlers */
      function onSend(){
        const v = qs('#promptInput').value.trim();
        if(!v){ toast('Prompt vazio'); return; }
        // plugue aqui o sendToOpenRouter(v)
        toast('Enviar: '+v);
        qs('#promptInput').value='';
      }
      function onVoz(){ toast('Voz ON'); /* plugue seu recorder/tts aqui */ }
      function onGif(){ toast('GIF picker'); /* abrir seu seletor de GIF */ }
      function onArteask(){ toast('Arteask presets'); /* abrir presets de Arteask */ }

      /* Painel Ações */
      const actions = qs('#actionsPanel');
      const dock = qs('#dock');
      function toggleActions(){ actions.classList.toggle('open'); saveUi(); }
      function copyPrompt(){
        const v = qs('#promptInput').value || '';
        navigator.clipboard?.writeText(v).then(()=>toast('Copiado'));
      }
      async function pastePrompt(){
        try{ const txt = await navigator.clipboard.readText(); if(txt){ qs('#promptInput').value = txt; } }
        catch(e){ toast('Permita acesso à área de transferência'); }
      }
      function toggleIcons(){
        dock.classList.toggle('hidden-icons'); saveUi();
      }

      /* Toggle Cards (.chat-card) */
      function toggleCards(){
        document.body.classList.toggle('hide-cards'); saveUi();
      }

      /* Persistência de UI */
      function saveUi(){
        const st = {
          actionsOpen: actions.classList.contains('open'),
          iconsHidden: dock.classList.contains('hidden-icons'),
          cardsHidden: document.body.classList.contains('hide-cards')
        };
        ls.set(STATE_KEY, st);
      }
      (function restoreUi(){
        const st = ls.get(STATE_KEY) || {};
        if(st.actionsOpen) actions.classList.add('open');
        if(st.iconsHidden) dock.classList.add('hidden-icons');
        if(st.cardsHidden) document.body.classList.add('hide-cards');
      })();

      /* SW */
      if('serviceWorker' in navigator){ window.addEventListener('load', ()=>navigator.serviceWorker.register('sw.js')); }
    </script>
  </body>
</html>